#!/usr/bin/env bash

source ~/.bash-my-aws/load.sh

ENV=${1:-Alpha}

my_query='
  Reservations[].Instances[][
      InstanceId,
      KeyName,
      PrivateIpAddress,
      PublicIpAddress,
      InstanceType,
      State.Name,
      [Tags[?Key==`Name`].Value][0][0]
  ]
 '
instances ${inputs} --query ${my_query} 

# generate aliases file
#while read id key ip extip type state name; do name=${name/ - /-}; name=${name/ /-}; echo "alias ${name/ /-}='slogin ubuntu@$ip -i ~/.ssh/$key.pem'"; done < <( list-aws | grep -vE "[[:blank:]]None[[:blank:]]" ) | sort > ~/aliases.gen

# list-aws | grep Alpha | grep -E 'order|shift|track' | awk '{print $3}' | while read i; do echo "slogin -o 'StrictHostKeyChecking=no' -i ~/.ssh/nekloteam.pem ubuntu@$i 'sudo /etc/init.d/wildfly restart'"; done | xargs -P0 -I{} bash -c "{}"
